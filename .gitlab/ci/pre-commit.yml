pre-commit:
    image: python:3.12-slim-bookworm
    stage: lint
    cache:
      - key:
          files:
            - .pre-commit-config.yaml
          prefix: pre-commit-
        paths:
          - .cache/pre-commit

    before_script:
      # pre-commit needs git to run
      - apt-get update && apt-get install -y git && rm -rf /var/lib/apt/lists/*
      - git config --global --add safe.directory "$CI_PROJECT_DIR"

    script:
      - pip install pre-commit
      - export PRE_COMMIT_HOME="$CI_PROJECT_DIR/.cache/pre-commit"
      - pre-commit run --all-files
